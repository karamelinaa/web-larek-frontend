# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении 

Карточка товара

```
interface IProductItem {
    id:string;
    description:string;
    image:string;
    title:string;
    category:string;
    price:number;
}
```

Превью карточки 

```
export interface IProductPreview {
    products: IProductItem[];
    preview: string | null;
    getProduct(productId: string) :IProductItem;
    setPreview(productId: string | null): void;
}
```

Модальное окно для товаров в корзине

```
export interface IProductInBasket {
    productIndex: number;
    productInBasket: IProductItem[]; 
    totalPrice: number;
    getProductInBasket() :IProductItem[];
    setProductInBasket(product: IProductItem[]): void;  
    deleteProduct(product: IProductItem): void;
}
```

Модальное окно для указания информации для оплаты 

```
interface IFormInfoOrder {
    payment:string;
    address:string;
}
```

Модальное окно для указания контакной информации 

```
interface IFormInfoOrderCustomer {
    email:string;
    phone:string;
}
```

Модальное окно после успешной покупки

```
export interface IOrderSuccess {
	id: string;
	total: number;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой данных, отвечает за хранение и изменение данных,
- слой представления, отвечает за отображение данных на - странице,
- презентер, отвечает за связь представления и данных.

## Базовый код 

#### Класс Api 

Содержит в себе базовую логику отправки запросов. Конструктор `constructor(baseUrl: string, options: RequestInit = {})`- принимает базовый URL и глобальные опции для всех запросов(опционально).

В полях класса хранятся следующие данные:

baseUrl: string - базовый URL
options: RequestInit - опции

Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

Типы:

- `type ApiPostMethods = 'POST' | 'PUT' | 'DELETE'` - метод отправки запроса

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Конструктор `constructor() {this._events = new Map<EventName, Set<Subscriber>>();}` - принимает коллекцию для хранения данных любого типа в виде пар [ключ, значение].

Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие
- `onAll` - слушать все события
- `offAll` - сбросить все обработчики
- `trigger` - сделать коллбек триггер, генерирующий событие при вызове.

### Слой данных 

#### Класс ProductPreview 

Класс отвечает за хранение и логику работы с данными товаров.
В полях класса хранятся следующие данные:

- _product: IProduct[] - массив объектов товаров
- _preview: string | null - id карточки товара, выбранной для просмотра в модальном окне

Так же класс предоставляет методы для взаимодействия с этими данными: 

- getProduct(productId: string) :IProductItem - возвращает карточку товара по ее Id
- setPreview(productId: string | null) -  устанавливает данные для предварительного просмотра выбранного продукта

#### Класс ProductInBasket

Класс представляет корзину покупок и предоставляет методы управления ее содержимым. Он хранит массив продуктов `IProductItem`, общую стоимость и порядковые номера продуктов.

В полях класса хранятся следующие данные:

- _productInBasket: IProductItem[] - массив объектов `IProductItem`, представляющих список продуктов в корзине
- totalPrice: number - общая стоимость продуктов в корзине
- productIndex: number - порядковый номер товара 

Так же класс предоставляет методы для взаимодействия с этими данными: 

- getProductInBasket() : IProductItem[] - получает массив объектов `IProductItem`, представляющих список продуктов в корзине
- setProductInBasket(product: IProductItem[]): void - устанавливает массив объектов `IProductItem` в качестве списка продуктов в корзине
- deleteProduct(product: IProductItem): void - удаляет объект `IProductItem` из списка продуктов в корзине

### Классы представления 
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal

Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.

- `constructor(container: HTMLElement, protected events: IEvents)` - конструктор принимает HTML элемент модального окна и экземпляр класса EventEmitter для возможности инициации событий. 

Поля класса: 

- _modal: HTMLElement - элемент модального окна 
- events: IEvents - брокер событий 

Методы:

- open() - открытие модального окна
- close() - закрытие модального окна
- set modal(value: HTMLElement) - устанавливает разметку модального окна

#### Класс ModalBasket 

Расширяет класс `Modal`. Отвечает за отображение корзины, включая список продуктов и общую стоимость. 
В конструктор класса constructor(container: HTMLFormElement, events: IEvents) передается DOM элемент темплейта, а так же экземпляр класса EventEmitter. 
Вешает обработчик события клика на кнопку оформить.\

Поля класса:

- _products: HTMLElement - контейнер для размещения продуктов
- _total: HTMLElement - общая сумма покупки 
- button: HTMLButtonElement - кнопка оформить

Методы:

- set total(total: number) - считает общую сумму товаров
- set products(listProducts: HTMLElement) - отображает список товаров
- changeButton(state :boolean) - меняет состояние кнопки в зависимости от наличия товаров в корзине

#### Класс ModalOrderForm

Расширяет класс `Modal`. Отвечает за отображение формы заказа, включая поля для адреса, телефона, электронной почты и способа оплаты.
В конструктор класса constructor(container: HTMLFormElement, events: IEvents) передается DOM элемент темплейта, а так же экземпляр класса EventEmitter. Вешается обработчик события на выбор способа оплаты.

Поля класса: 

- _payment: HTMLButtonElement - выбор способа оплаты
- _address: string - инпут для адреса
- _phone: string - инпут для номера телефона
- _email: string - инпут для почты
- _buttonNext: HTMLButtonElement - кнопка далее для оформления заказа

Методы:

- set payment (value: string) - установка способа оплаты
- set phone(value: string) - запись телефона  
- set address(value: string) - запись адреса
- set email(value: string) - запись email
- setValid(isValid: boolean) - меняет состояние кнопки на неактивную/активную, если не заполнены/заполнены поля ввода

#### Класс ProductTemplate

Класс генерирует карточки товаров, используемые на странице сайта для отображения доступных товаров. Он содержит элементы разметки для различных компонентов карточки продукта, таких как изображение, описание и кнопки добавления/удаления. В конструкторе класса передается DOM элемент темплейта, что позволяет при необходимости формитровать карточки товаров в  разных вариантах верстки. 

Поля класса содержат элементы разметки элементов товара:

- id: string - id товара
- description: HTMLElement - описание товара
- image: HTMLImageElement - изображение товара
- title: HTMLElement - название товара
- category: HTMLElement - категори товара
- productIndex: HTMLElement - порядковый номер товара в корзине
- addButton: HTMLButtonElemen - кнопка добавления в корзину
- deleteButton: HTMLButtonElement - кнопка удаления товара из корзины

Методы: 

Сеттеры и геттеры для сохранения и получения данных из полей класса.

#### Класс MainPage 

Отвечает за отображение главной страницы сайта, содержит корзину товаров со счетчиком, также список товаров. В конструктор класса constructor(container: HTMLElement, protected events: IEvents) передается DOM элемент темплейта, а так же экземпляр класса EventEmitter. Вешается обработчик события на нажатие кнопки корзины.

Поля класса:

- _products: HTMLElement - список товаров
- _basket: HTMLElement - корзина
- _basketCounter - количество товаров в корзине

Методы:

- set products(product: HTMLElement) - выводит товары на страницу
- set basketCounter(value: number) - устанавливает количество товаров в корзине 

### Слой коммуникаций 

#### Класс AppApi 

Принимает в конструкторе экземпляр класса Api и предоставляет методы взаимодействия с бэкендом сервиса. 

## Взаимодействие компонентов 

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

Список всех событий, которые могут генерироваться в системе:
События изменения данных (генерируются классами моделями данных)

- `products:changed` - изменение массива карточек
- `preview:changed` - выбрана карточка для показа

События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление): 

- `basket:open` - открытие корзины
- `basket:add` - добавление товара в корзину
- `basket:delete` - удаление товара из корзины
- `order:open` - открытие модального окна заказа
- `order.address:change` - инпут адреса
- `order.phone:change` - инпут номера телефона
- `order.email:change` - инпут email
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `payment:select` - выбор способа оплаты
- `order:submit` - кнопка далее в форме заказа